{"version":3,"file":"messages.js","names":["_express","require","_requireJwtAuth","_interopRequireDefault","_Message","_interopRequireWildcard","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","obj","router","Router","req","res","messages","Message","find","sort","createdAt","populate","json","map","m","toJSON","err","status","message","findById","params","id","post","requireJwtAuth","error","validateMessage","body","details","create","text","user","execPopulate","delete","tempMessage","role","findByIdAndRemove","put","findByIdAndUpdate","new","_default","exports"],"sources":["../../../src/routes/api/messages.js"],"sourcesContent":["import { Router } from 'express';\nimport requireJwtAuth from '../../middleware/requireJwtAuth';\nimport Message, { validateMessage } from '../../models/Message';\n\nconst router = Router();\n\nrouter.get('/', async (req, res) => {\n  try {\n    const messages = await Message.find().sort({ createdAt: 'desc' }).populate('user');\n\n    res.json({\n      messages: messages.map((m) => {\n        return m.toJSON();\n      }),\n    });\n  } catch (err) {\n    res.status(500).json({ message: 'Something went wrong.' });\n  }\n});\n\nrouter.get('/:id', async (req, res) => {\n  try {\n    const message = await Message.findById(req.params.id).populate('user');\n    if (!message) return res.status(404).json({ message: 'No message found.' });\n    res.json({ message: message.toJSON() });\n  } catch (err) {\n    res.status(500).json({ message: 'Something went wrong.' });\n  }\n});\n\nrouter.post('/', requireJwtAuth, async (req, res) => {\n  const { error } = validateMessage(req.body);\n  if (error) return res.status(400).json({ message: error.details[0].message });\n\n  try {\n    let message = await Message.create({\n      text: req.body.text,\n      user: req.user.id,\n    });\n    message = await message.populate('user').execPopulate();\n\n    res.status(200).json({ message: message.toJSON() });\n  } catch (err) {\n    res.status(500).json({ message: 'Something went wrong.' });\n  }\n});\n\nrouter.delete('/:id', requireJwtAuth, async (req, res) => {\n  try {\n    const tempMessage = await Message.findById(req.params.id).populate('user');\n    if (!(tempMessage.user.id === req.user.id || req.user.role === 'ADMIN'))\n      return res.status(400).json({ message: 'Not the message owner or admin.' });\n\n    const message = await Message.findByIdAndRemove(req.params.id).populate('user');\n    if (!message) return res.status(404).json({ message: 'No message found.' });\n    res.status(200).json({ message });\n  } catch (err) {\n    res.status(500).json({ message: 'Something went wrong.' });\n  }\n});\n\nrouter.put('/:id', requireJwtAuth, async (req, res) => {\n  const { error } = validateMessage(req.body);\n  if (error) return res.status(400).json({ message: error.details[0].message });\n\n  try {\n    const tempMessage = await Message.findById(req.params.id).populate('user');\n    if (!(tempMessage.user.id === req.user.id || req.user.role === 'ADMIN'))\n      return res.status(400).json({ message: 'Not the message owner or admin.' });\n\n    let message = await Message.findByIdAndUpdate(\n      req.params.id,\n      { text: req.body.text, user: tempMessage.user.id },\n      { new: true },\n    );\n    if (!message) return res.status(404).json({ message: 'No message found.' });\n    message = await message.populate('user').execPopulate();\n\n    res.status(200).json({ message });\n  } catch (err) {\n    res.status(500).json({ message: 'Something went wrong.' });\n  }\n});\n\nexport default router;\n"],"mappings":"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","ignoreList":[]}