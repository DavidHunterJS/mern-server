{"version":3,"file":"facebookStrategy.js","names":["_passport","_interopRequireDefault","require","_passportFacebook","_User","obj","__esModule","default","serverUrl","process","env","NODE_ENV","SERVER_URL_PROD","SERVER_URL_DEV","facebookLogin","FacebookStrategy","clientID","FACEBOOK_APP_ID","clientSecret","FACEBOOK_SECRET","callbackURL","FACEBOOK_CALLBACK_URL","profileFields","accessToken","refreshToken","profile","done","oldUser","User","findOne","email","emails","value","err","console","log","newUser","provider","facebookId","id","username","name","displayName","avatar","photos","save","passport","use"],"sources":["../../src/services/facebookStrategy.js"],"sourcesContent":["import passport from 'passport';\nimport { Strategy as FacebookStrategy } from 'passport-facebook';\n\nimport User from '../models/User';\n\nconst serverUrl = process.env.NODE_ENV === 'production' ? process.env.SERVER_URL_PROD : process.env.SERVER_URL_DEV;\n\n// facebook strategy\nconst facebookLogin = new FacebookStrategy(\n  {\n    clientID: process.env.FACEBOOK_APP_ID,\n    clientSecret: process.env.FACEBOOK_SECRET,\n    callbackURL: `${serverUrl}${process.env.FACEBOOK_CALLBACK_URL}`,\n    profileFields: [\n      'id',\n      'email',\n      'gender',\n      'profileUrl',\n      'displayName',\n      'locale',\n      'name',\n      'timezone',\n      'updated_time',\n      'verified',\n      'picture.type(large)',\n    ],\n  },\n  async (accessToken, refreshToken, profile, done) => {\n    // console.log(profile);\n    try {\n      const oldUser = await User.findOne({ email: profile.emails[0].value });\n\n      if (oldUser) {\n        return done(null, oldUser);\n      }\n    } catch (err) {\n      console.log(err);\n    }\n\n    // register user\n    try {\n      const newUser = await new User({\n        provider: 'facebook',\n        facebookId: profile.id,\n        username: `user${profile.id}`,\n        email: profile.emails[0].value,\n        name: profile.displayName,\n        avatar: profile.photos[0].value,\n      }).save();\n\n      done(null, newUser);\n    } catch (err) {\n      console.log(err);\n    }\n  },\n);\n\npassport.use(facebookLogin);\n"],"mappings":";;AAAA,IAAAA,SAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,iBAAA,GAAAD,OAAA;AAEA,IAAAE,KAAA,GAAAH,sBAAA,CAAAC,OAAA;AAAkC,SAAAD,uBAAAI,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAElC,MAAMG,SAAS,GAAGC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,YAAY,GAAGF,OAAO,CAACC,GAAG,CAACE,eAAe,GAAGH,OAAO,CAACC,GAAG,CAACG,cAAc;;AAElH;AACA,MAAMC,aAAa,GAAG,IAAIC,0BAAgB,CACxC;EACEC,QAAQ,EAAEP,OAAO,CAACC,GAAG,CAACO,eAAe;EACrCC,YAAY,EAAET,OAAO,CAACC,GAAG,CAACS,eAAe;EACzCC,WAAW,EAAG,GAAEZ,SAAU,GAAEC,OAAO,CAACC,GAAG,CAACW,qBAAsB,EAAC;EAC/DC,aAAa,EAAE,CACb,IAAI,EACJ,OAAO,EACP,QAAQ,EACR,YAAY,EACZ,aAAa,EACb,QAAQ,EACR,MAAM,EACN,UAAU,EACV,cAAc,EACd,UAAU,EACV,qBAAqB;AAEzB,CAAC,EACD,OAAOC,WAAW,EAAEC,YAAY,EAAEC,OAAO,EAAEC,IAAI,KAAK;EAClD;EACA,IAAI;IACF,MAAMC,OAAO,GAAG,MAAMC,aAAI,CAACC,OAAO,CAAC;MAAEC,KAAK,EAAEL,OAAO,CAACM,MAAM,CAAC,CAAC,CAAC,CAACC;IAAM,CAAC,CAAC;IAEtE,IAAIL,OAAO,EAAE;MACX,OAAOD,IAAI,CAAC,IAAI,EAAEC,OAAO,CAAC;IAC5B;EACF,CAAC,CAAC,OAAOM,GAAG,EAAE;IACZC,OAAO,CAACC,GAAG,CAACF,GAAG,CAAC;EAClB;;EAEA;EACA,IAAI;IACF,MAAMG,OAAO,GAAG,MAAM,IAAIR,aAAI,CAAC;MAC7BS,QAAQ,EAAE,UAAU;MACpBC,UAAU,EAAEb,OAAO,CAACc,EAAE;MACtBC,QAAQ,EAAG,OAAMf,OAAO,CAACc,EAAG,EAAC;MAC7BT,KAAK,EAAEL,OAAO,CAACM,MAAM,CAAC,CAAC,CAAC,CAACC,KAAK;MAC9BS,IAAI,EAAEhB,OAAO,CAACiB,WAAW;MACzBC,MAAM,EAAElB,OAAO,CAACmB,MAAM,CAAC,CAAC,CAAC,CAACZ;IAC5B,CAAC,CAAC,CAACa,IAAI,CAAC,CAAC;IAETnB,IAAI,CAAC,IAAI,EAAEU,OAAO,CAAC;EACrB,CAAC,CAAC,OAAOH,GAAG,EAAE;IACZC,OAAO,CAACC,GAAG,CAACF,GAAG,CAAC;EAClB;AACF,CACF,CAAC;AAEDa,iBAAQ,CAACC,GAAG,CAACjC,aAAa,CAAC","ignoreList":[]}